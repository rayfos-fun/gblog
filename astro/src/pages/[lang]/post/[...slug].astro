---
import { getCollection } from 'astro:content';
import PostLayout from '@/layouts/PostLayout.astro';

export async function getStaticPaths() {
  const posts = await getCollection('post');

  return posts.flatMap((post) => {
    const parts = post.slug.split('/');

    const lang = parts[0];
    const slug = parts.slice(1).join('/');

    return [{
      params: { 
        lang: lang, 
        slug: slug || undefined 
      },
      props: { post }, 
    }];
  });
}

const { post } = Astro.props;
if (!post) {
  throw new Error(`âŒ Errorï¼šURL ${Astro.url.pathname} (post prop is missing)`);
}

const { Content } = await post.render();
const { lang } = Astro.params;
---

<PostLayout title={post.data.title} lang={lang}>
  <article class="max-w-4xl mx-auto">
    <header class="mb-10 text-center">
      <h1 class="text-4xl font-bold mb-4">{post.data.title}</h1>
      <div class="text-gray-500 flex justify-center gap-4 text-sm">
        <span>ğŸ“… {post.data.date.toISOString().slice(0, 10)}</span>
      </div>
    </header>
    <div class="divider"></div>
    <div class="prose prose-lg max-w-none prose-img:rounded-xl">
      <Content />
    </div>
  </article>
</PostLayout>