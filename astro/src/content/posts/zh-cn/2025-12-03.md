---
title: '[技术复盘] 一个远程调用引发的系统雪崩：差点毁了我们团队的感恩节'
date: '2025-12-03'
description: 差点毁了感恩节！一个简单的远程调用（RPC）如何引发系统雪崩？技术复盘：在数据库事务里加外部依赖，就是给未来埋下的最大地雷。
---
最近组上的软件速度慢到令人发指，收到的故障工单（Bug Ticket）如雪片般飞来，砸在组上一个个灰头土脸，都没法放心放假（感恩节）了。

为了挽救我们的假期，团队开始了紧急排查。

### 诡异的数据库事务中止

检查系统日志（Log），观察到了大量的“数据库事务中止”（Database Transaction Abort）。
最后，发现原因是事务（Transaction）中间参杂了一些耗时且不稳定的“远程调用”（RPC），导致事务战线过长，造成资源死锁。

把事务里的远程调用撤走后，问题立马修复了。

### 查了个寂寞：代码里的“破窗效应”

一开始我们查了最近提交的代码，结果查了个寂寞，毕竟那些远程调用都不是最近才加的。
只是外部服务的响应时间非我们可控，然后随着用户有机增长，才导致问题显化。

**在事务里加远程调用这种“低级错误”，之所以会一开始被提交上去，本质上是因为问题的不显化。**

以前接口响应挺快的，用户用量不大，事务中止后自动重试（Retry）成功后，事就这么过去了，完全观察不到任何问题。
后来的开发者看代码库（Code base）上，在事务中加远程调用已是常态，自然不会多想，图个方便就多加几个进事务，也没观察到问题。

就这样，从一片雪花滚成一颗雪球，最后引发雪崩。

### 不吃一堑，不长一智

虽然在事务里呼叫保证耗时短、无状态（Stateless）的远程接口应该没什么太大问题，但外部依赖永远是最大的变量。

日后要想在事务里加远程调用，心里必然会三思而后行。为了系统的稳定性，也为了不被半夜叫醒，请保持事务的纯洁性。
