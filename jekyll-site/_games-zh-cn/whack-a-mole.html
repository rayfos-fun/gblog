---
title: "打地鼠"
layout: post
lang: zh-cn
permalink: /zh-cn/game/whack-a-mole/
date: 2025-10-02
---
<div class="game-wrapper bg-gray-50 flex flex-col items-center justify-start min-h-screen p-4">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html { font-family: 'Inter', sans-serif; }

    /* Custom CSS for the popping effect (弹出效果) */
    .mole-number {
      /* 初始位置：在地底下 100% */
      transform: translateY(100%); 
      /* 弹跳动画效果 */
      transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
    }

    /* 当洞口被标记为 'up' 时，数字弹出 */
    .hole.up .mole-number {
      transform: translateY(0);
    }

    /* 九宫格容器使用 Grid 佈局 */
    .grid-container {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(3, 1fr);
      gap: 0.5rem; /* 8px */
      max-width: 480px; /* 限制最大宽度，保持九宫格外观 */
      width: 95%;
      aspect-ratio: 1 / 1; /* 保持正方形 */
    }
    
    .hole {
      /* 模拟地洞的圆角和阴影 */
      box-shadow: inset 0 -10px 10px rgba(0, 0, 0, 0.1);
      user-select: none; /* 防止选取文字 */
    }

    .hit {
      /* 被点击时的闪烁效果 */
      background-color: #ef4444 !important; /* Tailwind red-500 */
    }
  </style>

  <div id="game-container" class="w-full max-w-lg bg-white p-6 rounded-xl shadow-2xl">
    <h1 class="text-3xl font-extrabold text-center text-indigo-700 mb-4">数字打地鼠 (1~9)</h1>
    <!-- 游戏资讯和控制区 -->
    <div class="flex flex-col sm:flex-row justify-between items-center mb-6 p-4 bg-indigo-100 rounded-lg shadow-inner">
      <p class="text-xl font-semibold text-gray-800 mb-2 sm:mb-0">分数: <span id="score" class="text-indigo-600">0</span></p>
      <p class="text-xl font-semibold text-gray-800 mb-2 sm:mb-0">时间: <span id="timer" class="text-indigo-600">30</span> 秒</p>
      <button id="startButton" class="w-full sm:w-auto px-6 py-2 bg-indigo-500 text-white font-bold rounded-full shadow-lg hover:bg-indigo-600   transition duration-150 transform hover:scale-105" disabled>载入中...</button>
    </div>
  
    <!-- 九宫格游戏区域 -->
    <div id="gridContainer" class="grid-container mx-auto p-3 bg-yellow-800 rounded-xl shadow-lg border-4 border-yellow-900">
      <!-- 洞口将由 JavaScript 填充 -->
    </div>
      
    <!-- 游戏结束提示框 (使用客製化 Modal 取代 alert) -->
    <div id="gameOverModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50">
      <div class="bg-white p-8 rounded-xl shadow-2xl text-center max-w-sm w-full">
        <h2 class="text-3xl font-bold text-indigo-700 mb-4">游戏结束！</h2>
        <p class="text-xl text-gray-700 mb-6">你的最终分数是: <span id="finalScore" class="font-extrabold text-4xl text-red-500">0</span></p>
        <button id="closeModalButton" class="px-6 py-3 bg-indigo-500 text-white font-semibold rounded-full hover:bg-indigo-600 transition duration-150"  >关闭</button>
      </div>
    </div>
  </div>

  <script>
// --- 变数宣告 ---
const scoreDisplay = document.getElementById('score');
const timerDisplay = document.getElementById('timer');
const startButton = document.getElementById('startButton');
const gridContainer = document.getElementById('gridContainer');
const gameOverModal = document.getElementById('gameOverModal');
const finalScoreDisplay = document.getElementById('finalScore');
const closeModalButton = document.getElementById('closeModalButton');

let score = 0;
let time = 30; // 游戏时间 30 秒
let timeUp = true;
let lastHole = null;
let countdownInterval;
let moleTimeout;
let holes = [];

// --- 辅助函数 ---

/** 随机选择一个洞口，避免与上一个重複 */
function randomHole(currentHoles) {
  const idx = Math.floor(Math.random() * currentHoles.length);
  const hole = currentHoles[idx];
    
  if (hole === lastHole) {
    return randomHole(currentHoles);
  }
  lastHole = hole;
  return hole;
}

/** 随机产生地鼠弹出时间 (毫秒) */
function randomTime(min, max) {
  return Math.round(Math.random() * (max - min) + min);
}

// --- 核心击打逻辑 ---

/** 核心击打逻辑：处理得分和视觉回馈 */
function whackHole(hole) {
  // 检查是否为 'up' 状态
  if (!hole || !hole.classList.contains('up')) return; 

  // 得分
  score++;
  scoreDisplay.textContent = score;

  // 视觉回馈：立即缩回并闪烁
  hole.classList.remove('up'); 
  hole.classList.add('hit');
    
  // 移除闪烁效果
  setTimeout(() => {
    hole.classList.remove('hit');
  }, 100); 
}

// --- 游戏逻辑函数 ---

/** 让数字 (地鼠) 弹出 */
function peep() {
  if (timeUp) return;

  const time = randomTime(500, 1500); // 弹出时间
  const hole = randomHole(holes);
    
  hole.classList.add('up'); 

  // 在随机时间后缩回并设定下一次弹出
  moleTimeout = setTimeout(() => {
    hole.classList.remove('up');
    peep(); // 递迴呼叫，持续弹出
  }, time);
}

/** 处理滑鼠点击事件 */
function handleMouseWhack(event) {
  whackHole(event.currentTarget);
}

/** 处理键盘按下事件 */
function handleKeyWhack(event) {
  // 游戏结束或非数字键时不处理
  if (timeUp || event.key.length > 1 || event.metaKey || event.ctrlKey || event.altKey) return;

  const keyPressed = event.key;
  const targetNumber = parseInt(keyPressed);

  // 检查按下的键是否为 1 到 9 的数字
  if (targetNumber >= 1 && targetNumber <= 9) {
    // 寻找目前弹出且数字符合的洞口
    const targetHole = holes.find(hole => {
      const holeNumber = parseInt(hole.getAttribute('data-number'));
      // 必须是弹出状态 且 数字相符
      return hole.classList.contains('up') && holeNumber === targetNumber;
    });

    if (targetHole) {
      whackHole(targetHole);
      // 阻止浏览器预设行为（例如数字键不会有预设行为，但这是好习惯）
      event.preventDefault(); 
    }
  }
}

/** 创建九宫格 (1~9) 及其事件监听器 */
function createGrid() {
  gridContainer.innerHTML = '';
  holes = [];
    
  for (let i = 1; i <= 9; i++) {
    // 洞口元素 (hole)
    const hole = document.createElement('div');
    hole.classList.add('hole', 'bg-lime-600', 'rounded-lg', 'relative', 'overflow-hidden');
    hole.setAttribute('data-number', i); // 新增 data-number 属性供键盘比对
    hole.addEventListener('click', handleMouseWhack); // 改用新的滑鼠处理函数

    // 数字元素 (mole-number)
    const moleNumber = document.createElement('div');
    moleNumber.classList.add('mole-number', 'text-4xl', 'font-extrabold', 'select-none', 'bg-lime-700', 'text-white', 'shadow-2xl');
    moleNumber.textContent = i; 
        
    hole.appendChild(moleNumber);
    gridContainer.appendChild(hole);
    holes.push(hole);
  }
}

/** 倒数计时器 */
function countdown() {
  time--;
  timerDisplay.textContent = time;

  if (time <= 0) {
    endGame();
  }
}

/** 游戏结束处理 */
function endGame() {
  clearInterval(countdownInterval);
  clearTimeout(moleTimeout);
  timeUp = true;
  startButton.textContent = '重新开始';
  startButton.disabled = false;
    
  // 确保所有地鼠缩回
  holes.forEach(hole => hole.classList.remove('up'));
    
  // 显示客製化 Modal
  finalScoreDisplay.textContent = score;
  gameOverModal.classList.remove('hidden');
}

/** 开始游戏 */
function startGame() {
  if (!timeUp) return;

  // 重设状态
  score = 0;
  time = 30;
  scoreDisplay.textContent = score;
  timerDisplay.textContent = time;
  timeUp = false;
  startButton.disabled = true;
  startButton.textContent = '游戏进行中...';

  // 关闭 Modal (如果它还开着)
  gameOverModal.classList.add('hidden');

  // 开始计时
  countdownInterval = setInterval(countdown, 1000);

  // 开始弹出数字
  peep();
}

// --- 事件监听器和初始化 ---

document.addEventListener('DOMContentLoaded', () => {
  createGrid();
  startButton.textContent = '开始游戏';
  startButton.disabled = false;
    
  // ** 新增键盘事件监听器 **
  document.addEventListener('keydown', handleKeyWhack);
});

startButton.addEventListener('click', startGame);

closeModalButton.addEventListener('click', () => {
  gameOverModal.classList.add('hidden');
});
    
  </script>
</div>